    <!-- About Modal -->
    <div id="about-modal" class="modal">
        <div class="modal-content small-modal">
            <div class="modal-header">
                <h3>About Wave Agent X</h3>
                <button class="modal-close" id="about-close-btn">&times;</button>
            </div>
            <div class="modal-body">
                <p><strong>Wave Agent X</strong></p>
                <p>Version: <span id="about-version">...</span></p>
                <p>&copy; 2025 Pauli. All rights reserved.</p>
                <p>This app is a professional audio metadata and file management tool for production sound workflows.</p>
            </div>
            <div class="modal-footer">
                <button class="btn secondary" id="about-ok-btn">OK</button>
            </div>
        </div>
    </div>

<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Wave Agent X</title>
    <link rel="icon" type="image/x-icon" href="favicon.ico">
    <link rel="stylesheet" href="style.css">
    <link rel="manifest" href="manifest.json">
    <meta name="theme-color" content="#1e1e1e">
</head>

<body>
    <div class="app-container">
        <!-- Header & Import -->
        <header class="app-header">
            <h1>Wave Agent X</h1>
            <div class="header-controls">
                <div class="batch-actions">
                    <button id="import-btn" class="btn secondary">Import</button>
                    <button id="batch-remove-btn" class="btn secondary" disabled>Remove</button>
                    <button id="batch-delete-btn" class="btn secondary" disabled>Delete</button>
                    <button id="batch-edit-btn" class="btn secondary" disabled>Batch Edit</button>
                    <button id="batch-save-btn" class="btn secondary" disabled>Save</button>
                </div>
                <div class="auto-save-toggle">
                    <label>
                        <input type="checkbox" id="auto-save-checkbox">
                        <span>Auto-save metadata changes</span>
                    </label>
                </div>
            </div>
        </header>
        <input type="file" id="file-input" multiple accept=".wav,.mp3,.aac" style="display: none;">

        <!-- Metadata List -->
        <section class="metadata-section">
            <div class="table-container">
                <table id="metadata-table">
                    <thead>
                        <tr id="table-header">
                            <th draggable="true" data-column="3">Filename</th>
                            <th draggable="true" data-column="12">Project</th>
                            <th draggable="true" data-column="11">Tape</th>
                            <th draggable="true" data-column="0">Channels</th>
                            <th draggable="true" data-column="1">Bit Depth</th>
                            <th draggable="true" data-column="2">Sample Rate</th>
                            <th draggable="true" data-column="4">Format</th>
                            <th draggable="true" data-column="5">Scene</th>
                            <th draggable="true" data-column="6">Take</th>
                            <th draggable="true" data-column="7">Duration</th>
                            <th draggable="true" data-column="8">Start TC</th>
                            <th draggable="true" data-column="13">End TC</th>
                            <th draggable="true" data-column="9">FPS</th>
                            <th draggable="true" data-column="10">File Size</th>
                            <th draggable="true" data-column="14">Notes</th>
                        </tr>
                    </thead>
                    <tbody id="file-list-body">
                        <!-- Rows will be populated here -->
                    </tbody>
                </table>
            </div>
        </section>

        <!-- File Operations Toolbar -->
        <div class="file-operations-toolbar">
            <button id="multi-process-btn" class="btn secondary">Multi-Process</button>
            <button id="export-tc-range-btn" class="btn secondary" disabled>Extract TC Range</button>
            <button id="conform-csv-btn" class="btn secondary">Conform to CSV</button>
            <button id="combine-btn" class="btn secondary" disabled>Combine</button>
            <button id="split-btn" class="btn secondary" disabled>Split</button>
            <button id="normalize-btn" class="btn secondary" disabled>Normalize</button>
            <button id="rename-btn" class="btn secondary" disabled>Rename</button>
            <button id="report-btn" class="btn secondary">Report</button>
            <button id="auto-group-btn" class="btn secondary" disabled>Auto-Group</button>
            <button id="diagnostics-btn" class="btn secondary" disabled>Diagnostics</button>
        </div>

        <!-- Player & Waveform -->
        <section class="player-section collapsible expanded">
            <div class="section-header">
                <h2 id="player-filename" style="font-weight: normal;">No file loaded</h2>
                <div class="transport-controls">
                    <button id="play-btn" class="btn-icon">‚ñ∂</button>
                    <button id="stop-btn" class="btn-icon">‚èπ</button>
                    <button id="loop-btn" class="btn-icon">‚Üª</button>
                    <div class="time-display">
                        <span id="current-time">00:00:00.00</span> / <span id="total-time">00:00:00.00</span>
                    </div>
                    <div class="time-display" style="margin-left: 1rem;">
                        <span style="color: var(--text-muted); font-size: 0.9em;">TC:</span>
                        <span id="current-timecode">00:00:00:00</span>
                    </div>
                </div>
                <div style="display: flex; gap: 10px; align-items: center;">
                    <button class="toggle-btn">‚ñº</button>
                </div>
            </div>
            <div class="section-content">
                <div id="region-selector" class="region-selector">
                    <span class="region-hint">Click and drag = create region. M = add marker. Delete = remove selected marker. Click and drag marker to move it. <,> = skip between markers</span>
                    <div id="region-tooltip" class="region-tooltip" style="display:none;"></div>
                </div>
                <div class="waveform-wrapper">
                    <div class="amplitude-scale">
                        <div class="scale-mark" style="top: 0%;">0</div>
                        <div class="scale-mark" style="top: 16.67%;">-10</div>
                        <div class="scale-mark" style="top: 33.33%;">-20</div>
                        <div class="scale-mark" style="top: 50%;">-‚àû</div>
                        <div class="scale-mark" style="top: 66.67%;">-20</div>
                        <div class="scale-mark" style="top: 83.33%;">-10</div>
                        <div class="scale-mark" style="top: 100%;">0</div>
                    </div>
                    <div class="waveform-container">
                        <canvas id="waveform-canvas"></canvas>
                        <div id="region-overlay" class="region-overlay"></div>
                        <div id="playhead"></div>
                        <div id="loading-overlay" class="loading-overlay" style="display: none;">
                            <div class="loading-content">
                                <div class="loading-text">Loading audio...</div>
                                <div class="progress-bar">
                                    <div id="progress-fill" class="progress-fill"></div>
                                </div>
                                <div id="progress-text" class="progress-text">0%</div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </section>

        <!-- Mixer -->
        <section class="mixer-section collapsible expanded">
            <div class="section-header">
                <h2>Channel Mixer</h2>
                <div style="display: flex; gap: 10px; align-items: center;">
                    <button id="mute-all-btn" class="btn secondary">Mute All</button>
                    <button id="arm-all-btn" class="btn secondary">Arm All</button>
                    <button id="clear-all-automation-btn" class="btn secondary">Clear All Automation</button>
                    <button id="save-mix-btn" class="btn secondary" disabled>Save Mix to File</button>
                    <button id="load-mix-btn" class="btn secondary" disabled>Load Mix from File</button>
                    <button id="export-btn" class="btn secondary" disabled>Export</button>
                    <button class="toggle-btn">‚ñº</button>
                </div>
            </div>
            <div class="fader-resize-divider" id="fader-resize-divider" title="Drag to resize faders (100px - 300px)"></div>
            <div class="section-content">
                <div id="mixer-container" class="mixer-strips">
                    <!-- Channel strips will be generated here -->
                </div>
            </div>
        </section>

        <!-- Batch Edit Modal -->
        <div id="batch-edit-modal" class="modal">
            <div class="modal-content">
                <div class="modal-header">
                    <h2>Batch Edit Metadata</h2>
                    <button class="modal-close" id="modal-close-btn">&times;</button>
                </div>
                <div class="modal-body">
                    <p class="modal-info">Editing <span id="selected-count">0</span> selected file(s)</p>

                    <div class="batch-edit-form">
                        <div class="form-row">
                            <input type="checkbox" id="apply-scene" class="apply-checkbox">
                            <label for="apply-scene">Scene:</label>
                            <input type="text" id="batch-scene" placeholder="Scene name">
                        </div>

                        <div class="form-row">
                            <input type="checkbox" id="apply-take" class="apply-checkbox">
                            <label for="apply-take">Take:</label>
                            <input type="text" id="batch-take" placeholder="Take number">
                        </div>

                        <div class="form-row">
                            <input type="checkbox" id="apply-project" class="apply-checkbox">
                            <label for="apply-project">Project:</label>
                            <input type="text" id="batch-project" placeholder="Project name">
                        </div>

                        <div class="form-row">
                            <input type="checkbox" id="apply-tape" class="apply-checkbox">
                            <label for="apply-tape">Tape:</label>
                            <input type="text" id="batch-tape" placeholder="Tape name">
                        </div>

                        <div class="form-row">
                            <input type="checkbox" id="apply-notes" class="apply-checkbox">
                            <label for="apply-notes">Notes:</label>
                            <textarea id="batch-notes" placeholder="Notes" rows="3"></textarea>
                        </div>
                    </div>
                </div>
                <div class="modal-footer">
                    <button id="batch-apply-btn" class="btn primary">Apply Changes</button>
                    <button id="batch-cancel-btn" class="btn secondary">Cancel</button>
                </div>
            </div>
        </div>

        <!-- Delete Confirmation Modal -->
        <div id="delete-confirm-modal" class="modal">
            <div class="modal-content">
                <div class="modal-header">
                    <h2>Delete Files</h2>
                    <button class="modal-close" id="delete-modal-close-btn">&times;</button>
                </div>
                <div class="modal-body">
                    <p class="modal-info">You have selected <span id="delete-count">0</span> file(s) to delete.</p>
                    <p style="margin-top: 1rem; color: #ff6b6b; font-weight: bold;">‚ö†Ô∏è Warning: Files will be permanently deleted and cannot be recovered.</p>
                    <p style="margin-top: 0.5rem; font-size: 0.9rem; color: var(--text-secondary);">Note: Web browsers cannot move files to the system Trash.</p>
                </div>
                <div class="modal-footer">
                    <button id="delete-permanent-btn" class="btn" style="background-color: #ff6b6b; color: white;">Delete Permanently</button>
                    <button id="delete-cancel-btn" class="btn secondary">Cancel</button>
                </div>
            </div>
        </div>

        <!-- Diagnostics Modal -->
        <div id="diagnostics-modal" class="modal">
            <div class="modal-content">
                <div class="modal-header">
                    <div>
                        <h2>Diagnostics</h2>
                        <p id="diagnostics-filename-indicator" style="font-size: 0.85rem; color: var(--text-secondary); margin: 0.5rem 0 0 0; font-weight: normal;">No file selected</p>
                    </div>
                    <button class="modal-close" id="diagnostics-close-btn">&times;</button>
                </div>
                <div class="modal-body">
                    <div class="tab-buttons">
                        <button id="ixml-tab-btn" class="tab-btn active">View iXML</button>
                        <button id="bext-tab-btn" class="tab-btn">View bEXT</button>
                        <button id="tools-tab-btn" class="tab-btn">Tools</button>
                    </div>
                    <div id="ixml-tab-content" class="tab-content active">
                        <pre id="ixml-content"
                            style="background-color: var(--bg-dark); padding: 1rem; border-radius: 4px; overflow-x: auto; overflow-y: auto; height: 28rem; min-height: 28rem; font-size: 0.85rem; line-height: 1.4; white-space: pre-wrap;"></pre>
                    </div>
                    <div id="bext-tab-content" class="tab-content">
                        <pre id="bext-content"
                            style="background-color: var(--bg-dark); padding: 1rem; border-radius: 4px; overflow-x: auto; overflow-y: auto; height: 28rem; min-height: 28rem; font-size: 0.85rem; line-height: 1.4; white-space: pre-wrap;"></pre>
                    </div>
                    <div id="tools-tab-content" class="tab-content">
                        <div style="padding: 1rem;">
                            <h3>iXML Testing Tools</h3>
                            <p>Use these tools to test iXML repair functionality:</p>
                            <div style="margin-top: 1rem;">
                                <button id="corrupt-ixml-modal-btn" class="btn secondary" style="background-color: #ff6b6b; color: white; margin-right: 1rem;">Corrupt iXML (Test)</button>
                                <button id="repair-ixml-modal-btn" class="btn secondary" title="Repair the iXML metadata in the selected file">Repair iXML</button>
                            </div>
                            <p style="margin-top: 1rem; font-size: 0.9rem; color: var(--text-secondary);">Note: Corrupt iXML only works on a single file. Repair iXML works on one or more selected files.</p>
                        </div>
                    </div>
                </div>
                <div class="modal-footer">
                    <button id="diagnostics-modal-close-btn" class="btn secondary">Close</button>
                </div>
            </div>
        </div>
    </div>

    <!-- Normalize Modal -->
    <div id="normalize-modal" class="modal">
        <div class="modal-content small-modal">
            <div class="modal-header">
                <h3>Normalize Audio</h3>
                <button class="modal-close">&times;</button>
            </div>
            <div class="modal-body">
                <p>Normalize the peak level to:</p>
                <div class="input-group">
                    <label for="normalize-target">Target Level (dBFS):</label>
                    <input type="number" id="normalize-target" min="-20" max="0" step="0.1" value="-1.0">
                </div>
                <p class="info-text">This will apply gain to bring the highest peak to this
                    level.</p>
            </div>
            <div class="modal-footer">
                <button id="cancel-normalize-btn" class="btn secondary">Cancel</button>
                <button id="confirm-normalize-btn" class="btn primary">Normalize</button>
            </div>
        </div>
    </div>

    <!-- Scripts -->
    <!-- Rename Modal -->
    <div id="rename-modal" class="modal">
        <div class="modal-content multi-process-modal">
            <div class="modal-header">
                <h3>Rename</h3>
                <button class="modal-close">&times;</button>
            </div>
            <div class="modal-body">
                <div class="mp-inline-options">
                    <div class="mp-input-group">
                        <label>Field 1:</label>
                        <select id="rename-field1" class="mp-field-select" style="min-width: 90px;">
                            <option value="none">None</option>
                            <option value="project">Project</option>
                            <option value="tape">Tape</option>
                            <option value="scene">Scene</option>
                            <option value="take">Take</option>
                            <option value="custom">Custom</option>
                        </select>
                        <input type="text" id="rename-custom1" placeholder="custom text" style="min-width: 90px; display: none;">
                    </div>
                    <div class="mp-input-group">
                        <label>Sep 1:</label>
                        <select id="rename-separator1" style="min-width: 60px;">
                            <option value="" selected>None</option>
                            <option value="T">T</option>
                            <option value="-">-</option>
                            <option value="_">_</option>
                            <option value="=">=</option>
                            <option value="~">~</option>
                            <option value="+">+</option>
                            <option value=",">,</option>
                            <option value=".">.</option>
                        </select>
                    </div>
                    <div class="mp-input-group">
                        <label>Field 2:</label>
                        <select id="rename-field2" class="mp-field-select" style="min-width: 90px;">
                            <option value="none">None</option>
                            <option value="project">Project</option>
                            <option value="tape">Tape</option>
                            <option value="scene" selected>Scene</option>
                            <option value="take">Take</option>
                            <option value="custom">Custom</option>
                        </select>
                        <input type="text" id="rename-custom2" placeholder="custom text" style="min-width: 90px; display: none;">
                    </div>
                    <div class="mp-input-group">
                        <label>Sep 2:</label>
                        <select id="rename-separator2" style="min-width: 60px;">
                            <option value="">None</option>
                            <option value="T" selected>T</option>
                            <option value="-">-</option>
                            <option value="_">_</option>
                            <option value="=">=</option>
                            <option value="~">~</option>
                            <option value="+">+</option>
                            <option value=",">,</option>
                            <option value=".">.</option>
                        </select>
                    </div>
                    <div class="mp-input-group">
                        <label>Field 3:</label>
                        <select id="rename-field3" class="mp-field-select" style="min-width: 90px;">
                            <option value="none">None</option>
                            <option value="project">Project</option>
                            <option value="tape">Tape</option>
                            <option value="scene">Scene</option>
                            <option value="take" selected>Take</option>
                            <option value="custom">Custom</option>
                        </select>
                        <input type="text" id="rename-custom3" placeholder="custom text" style="min-width: 90px; display: none;">
                    </div>
                </div>
                
                <div class="preview-box">
                    <label>Preview:</label>
                    <div id="rename-preview" class="preview-text">Select fields to see preview</div>
                </div>
            </div>
            <div class="modal-footer">
                <button id="cancel-rename-btn" class="btn secondary">Cancel</button>
                <button id="confirm-rename-btn" class="btn primary">Rename</button>
            </div>
        </div>
    </div>

    <!-- Export Modal -->
    <div id="export-modal" class="modal">
        <div class="modal-content small-modal">
            <div class="modal-header">
                <h3>Export Mix</h3>
                <button class="modal-close">&times;</button>
            </div>
            <div class="modal-body">
                <div class="input-group">
                    <label>Mix Mode:</label>
                    <div class="radio-group">
                        <label>
                            <input type="radio" name="mix-mode" value="bypass">
                            Bypass Mix <span class="radio-hint">(Unity gain, default pans)</span>
                        </label>
                        <label>
                            <input type="radio" name="mix-mode" value="current" checked>
                            Use Current Mix <span class="radio-hint">(Static mixer settings)</span>
                        </label>
                        <label>
                            <input type="radio" name="mix-mode" value="automation">
                            Use Automation <span class="radio-hint">(Automated fader movements)</span>
                        </label>
                    </div>
                </div>

                <div class="input-group">
                    <label for="export-channels">Channels:</label>
                    <select id="export-channels">
                        <option value="stereo" selected>Stereo (2ch)</option>
                        <option value="mono">Mono (1ch)</option>
                    </select>
                </div>

                <div class="input-group">
                    <label for="export-format">Format:</label>
                    <select id="export-format">
                        <option value="wav">WAV</option>
                        <option value="mp3">MP3</option>
                    </select>
                </div>

                <!-- WAV Options -->
                <div id="wav-options" class="format-options">
                    <div class="input-group">
                        <label for="export-bitdepth">Bit Depth:</label>
                        <select id="export-bitdepth">
                            <option value="16">16-bit PCM</option>
                            <option value="24" selected>24-bit PCM</option>
                            <option value="32">32-bit Float</option>
                        </select>
                    </div>
                </div>

                <!-- MP3 Options -->
                <div id="mp3-options" class="format-options" style="display: none;">
                    <div class="input-group">
                        <label for="export-mp3-bitrate">Bitrate:</label>
                        <select id="export-mp3-bitrate">
                            <option value="320">320 kbps</option>
                            <option value="256">256 kbps</option>
                            <option value="192" selected>192 kbps</option>
                            <option value="128">128 kbps</option>
                            <option value="64">64 kbps</option>
                        </select>
                    </div>
                </div>


            </div>
            <div class="modal-footer">
                <button id="cancel-export-btn" class="btn secondary">Cancel</button>
                <button id="confirm-export-btn" class="btn primary">Export</button>
            </div>
        </div>
    </div>

    <!-- Cue Marker Edit Modal -->
    <!-- Export TC Range Modal -->
    <div id="export-tc-range-modal" class="modal">
        <div class="modal-content small-modal">
            <div class="modal-header">
                <h3>Export Timecode Range</h3>
                <button class="modal-close" id="export-tc-range-close-btn">&times;</button>
            </div>
            <div class="modal-body">
                <div class="input-group">
                    <label for="export-tc-start">Start Time (HH:MM:SS):</label>
                    <input type="text" id="export-tc-start" placeholder="HH:MM:SS" value="00:00:00">
                </div>
                <div class="input-group">
                    <label for="export-tc-end">End Time (HH:MM:SS):</label>
                    <input type="text" id="export-tc-end" placeholder="HH:MM:SS" value="00:01:00">
                </div>
                <div class="input-group">
                    <label for="export-tc-format">Format:</label>
                    <select id="export-tc-format">
                        <option value="wav">WAV</option>
                        <option value="mp3">MP3</option>
                    </select>
                </div>
                <div id="export-tc-wav-options" class="format-options">
                    <div class="input-group">
                        <label for="export-tc-bitdepth">Bit Depth:</label>
                        <select id="export-tc-bitdepth">
                            <option value="16">16-bit PCM</option>
                            <option value="24" selected>24-bit PCM</option>
                            <option value="32">32-bit Float</option>
                        </select>
                    </div>
                </div>
                <div id="export-tc-mp3-options" class="format-options" style="display: none;">
                    <div class="input-group">
                        <label for="export-tc-mp3-bitrate">Bitrate:</label>
                        <select id="export-tc-mp3-bitrate">
                            <option value="320">320 kbps</option>
                            <option value="256">256 kbps</option>
                            <option value="192" selected>192 kbps</option>
                            <option value="128">128 kbps</option>
                            <option value="64">64 kbps</option>
                        </select>
                    </div>
                </div>
            </div>
            <div class="modal-footer">
                <button id="cancel-export-tc-range-btn" class="btn secondary">Cancel</button>
                <button id="confirm-export-tc-range-btn" class="btn primary">Export Range</button>
            </div>
        </div>
    </div>

    <!-- Conform to CSV Modal -->
    <div id="conform-csv-modal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h3>Auto-Conform to CSV</h3>
                <button class="modal-close" id="conform-csv-close-btn">&times;</button>
            </div>
            <div class="modal-body">
                <div class="input-group">
                    <button id="choose-csv-btn" class="btn secondary">Choose .CSV</button>
                    <span id="csv-filename-display" style="margin-left: 1rem; color: var(--text-muted);">No file selected</span>
                </div>
                <div class="input-group" style="margin-top: 1rem;">
                    <label for="conform-bitdepth">Output Bit Depth:</label>
                    <select id="conform-bitdepth">
                        <option value="16">16-bit PCM</option>
                        <option value="24" selected>24-bit PCM</option>
                        <option value="32">32-bit Float</option>
                    </select>
                </div>
                <div class="input-group" style="margin-top: 1rem;">
                    <label for="conform-prepost-roll">Pre/Post Roll:</label>
                    <select id="conform-prepost-roll">
                        <option value="0" selected>0 seconds</option>
                        <option value="1">1 second</option>
                        <option value="2">2 seconds</option>
                        <option value="3">3 seconds</option>
                        <option value="4">4 seconds</option>
                        <option value="5">5 seconds</option>
                        <option value="6">6 seconds</option>
                        <option value="7">7 seconds</option>
                        <option value="8">8 seconds</option>
                        <option value="9">9 seconds</option>
                        <option value="10">10 seconds</option>
                    </select>
                </div>
                <div class="table-container" style="margin-top: 1rem; max-height: 300px; overflow-y: auto;">
                    <table id="csv-preview-table" style="display: none;">
                        <thead>
                            <tr>
                                <th>File Name</th>
                                <th>Scene</th>
                                <th>Take</th>
                                <th>Length</th>
                                <th>Start TC</th>
                            </tr>
                        </thead>
                        <tbody id="csv-preview-body">
                            <!-- CSV preview rows populated here -->
                        </tbody>
                    </table>
                </div>
            </div>
            <div class="modal-footer">
                <button id="cancel-conform-csv-btn" class="btn secondary">Cancel</button>
                <button id="conform-csv-button" class="btn primary" disabled>Conform</button>
            </div>
        </div>
    </div>

    <!-- Conform Progress Modal -->
    <div id="conform-progress-modal" class="modal">
        <div class="modal-content small-modal">
            <div class="modal-header">
                <h3>Conforming Files...</h3>
            </div>
            <div class="modal-body">
                <p id="conform-progress-status">Preparing...</p>
                <div class="progress-bar-container" style="width: 100%; height: 24px; background: var(--bg-secondary); border-radius: 4px; overflow: hidden; margin: 1rem 0;">
                    <div id="conform-progress-bar" style="height: 100%; background: var(--accent-primary); width: 0%; transition: width 0.3s;"></div>
                </div>
                <p id="conform-progress-text" style="text-align: center; color: var(--text-muted);">0%</p>
            </div>
        </div>
    </div>

    <!-- Multi-Process Modal -->
    <div id="multi-process-modal" class="modal">
        <div class="modal-content multi-process-modal">
            <div class="modal-header">
                <h3>MULTI-PROCESS</h3>
                <button class="modal-close" id="multi-process-close-btn">&times;</button>
            </div>
            <p style="padding: 0 1.5rem; color: var(--text-muted); font-size: 0.9rem; margin: 0.5rem 0 1rem 0;">Choose which operations to apply to the selected files</p>

            <div class="modal-body">
                
                <!-- Keep Intermediate Files Option -->
                <div style="padding: 0.75rem 1rem; background: rgba(255, 149, 0, 0.1); border: 1px solid var(--accent-primary); border-radius: 6px; margin-bottom: 1.5rem;">
                    <label style="display: flex; align-items: center; gap: 0.75rem; cursor: pointer; user-select: none;">
                        <input type="checkbox" id="mp-keep-intermediate" style="width: 18px; height: 18px; cursor: pointer; accent-color: var(--accent-primary);">
                        <span style="font-size: 0.95rem; color: var(--text-main);">Keep intermediate files (for debugging/development)</span>
                    </label>
                    <p style="margin: 0.5rem 0 0 2rem; font-size: 0.85rem; color: var(--text-muted);">When unchecked, only the final processed file will be saved</p>
                </div>
                
                <!-- Extract Audio Section -->
                <div class="mp-section">
                    <label class="mp-checkbox-label">
                        <input type="checkbox" id="mp-extract-audio" class="mp-checkbox">
                        <span>Extract Audio</span>
                    </label>
                    
                    <div class="mp-options" id="mp-extract-options">
                        <div class="mp-radio-group">
                            <label class="mp-radio-label">
                                <input type="radio" name="mp-extract-mode" value="tc-range" id="mp-tc-range" checked>
                                <span>TC Range (HH:MM:SS)</span>
                            </label>
                            <div class="mp-tc-inputs">
                                <div class="mp-input-group">
                                    <label>Start:</label>
                                    <input type="text" id="mp-tc-start" value="01:00:00" placeholder="HH:MM:SS">
                                </div>
                                <div class="mp-input-group">
                                    <label>End:</label>
                                    <input type="text" id="mp-tc-end" value="01:01:00" placeholder="HH:MM:SS">
                                </div>
                            </div>
                        </div>
                        
                        <div class="mp-radio-group">
                            <label class="mp-radio-label">
                                <input type="radio" name="mp-extract-mode" value="conform-csv" id="mp-conform-csv">
                                <span>Conform to CSV</span>
                            </label>
                            <div class="mp-csv-controls">
                                <button id="mp-choose-csv-btn" class="btn secondary small-btn">Choose CSV</button>
                                <span id="mp-csv-filename" class="mp-csv-filename">test123.csv</span>
                                <div class="mp-input-group">
                                    <label>Pre/Post Roll:</label>
                                    <select id="mp-prepost-roll">
                                        <option value="0">0 secs</option>
                                        <option value="1">1 sec</option>
                                        <option value="2">2 secs</option>
                                        <option value="3">3 secs</option>
                                        <option value="4">4 secs</option>
                                        <option value="5">5 secs</option>
                                        <option value="6">6 secs</option>
                                        <option value="7">7 secs</option>
                                        <option value="8">8 secs</option>
                                        <option value="9">9 secs</option>
                                        <option value="10" selected>10 secs</option>
                                    </select>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Create Summed Mono Mix Section -->
                <div class="mp-section">
                    <label class="mp-checkbox-label">
                        <input type="checkbox" id="mp-create-mix" class="mp-checkbox">
                        <span>Create Summed Mono Mix</span>
                    </label>
                    <div class="mp-inline-options" id="mp-mix-options">
                        <div class="mp-input-group">
                            <label>Mix Placement:</label>
                            <select id="mp-mix-placement">
                                <option value="embed" selected>Embed in Poly (Ch 1)</option>
                                <option value="separate">Separate File</option>
                            </select>
                        </div>
                    </div>
                </div>

                <!-- Combine to Poly Section -->
                <div class="mp-section">
                    <div style="display: flex; align-items: center; gap: 0.75rem;">
                        <label class="mp-checkbox-label" style="margin: 0;">
                            <input type="checkbox" id="mp-combine-poly" class="mp-checkbox">
                            <span>Combine to Poly</span>
                        </label>
                        <button id="mp-channel-order-btn" class="btn secondary small-btn" style="white-space: nowrap;">Channel Order</button>
                    </div>
                </div>

                <!-- Normalize Section -->
                <div class="mp-section">
                    <label class="mp-checkbox-label">
                        <input type="checkbox" id="mp-normalize" class="mp-checkbox">
                        <span>Normalize</span>
                    </label>
                    <div class="mp-inline-options" id="mp-normalize-options">
                        <div class="mp-input-group">
                            <label>Level (dBFS):</label>
                            <input type="number" id="mp-normalize-level" value="-1.0" step="0.1" min="-60" max="0">
                        </div>
                    </div>
                </div>

                <!-- Rename Section -->
                <div class="mp-section">
                    <label class="mp-checkbox-label">
                        <input type="checkbox" id="mp-rename" class="mp-checkbox">
                        <span>Rename</span>
                    </label>
                    <div class="mp-inline-options" id="mp-rename-options">
                        <div class="mp-input-group">
                            <label>Field 1:</label>
                            <select id="mp-rename-field1" class="mp-field-select" style="min-width: 90px;">
                                <option value="none">None</option>
                                <option value="project">Project</option>
                                <option value="tape">Tape</option>
                                <option value="scene">Scene</option>
                                <option value="take">Take</option>
                                <option value="custom" selected>Custom</option>
                            </select>
                            <input type="text" id="mp-rename-custom1" placeholder="custom text" style="min-width: 90px; display: none;">
                        </div>
                        <div class="mp-input-group">
                            <label>Sep 1:</label>
                            <select id="mp-rename-separator1" style="min-width: 60px;">
                                <option value="" selected>None</option>
                                <option value="T">T</option>
                                <option value="-">-</option>
                                <option value="_">_</option>
                                <option value="=">=</option>
                                <option value="~">~</option>
                                <option value="+">+</option>
                                <option value=",">,</option>
                                <option value=".">.</option>
                            </select>
                        </div>
                        <div class="mp-input-group">
                            <label>Field 2:</label>
                            <select id="mp-rename-field2" class="mp-field-select" style="min-width: 90px;">
                                <option value="none">None</option>
                                <option value="project">Project</option>
                                <option value="tape">Tape</option>
                                <option value="scene" selected>Scene</option>
                                <option value="take">Take</option>
                                <option value="custom">Custom</option>
                            </select>
                            <input type="text" id="mp-rename-custom2" placeholder="custom text" style="min-width: 90px; display: none;">
                        </div>
                        <div class="mp-input-group">
                            <label>Sep 2:</label>
                            <select id="mp-rename-separator2" style="min-width: 60px;">
                                <option value="">None</option>
                                <option value="T" selected>T</option>
                                <option value="-">-</option>
                                <option value="_">_</option>
                                <option value="=">=</option>
                                <option value="~">~</option>
                                <option value="+">+</option>
                                <option value=",">,</option>
                                <option value=".">.</option>
                            </select>
                        </div>
                        <div class="mp-input-group">
                            <label>Field 3:</label>
                            <select id="mp-rename-field3" class="mp-field-select" style="min-width: 90px;">
                                <option value="none">None</option>
                                <option value="project">Project</option>
                                <option value="tape">Tape</option>
                                <option value="scene">Scene</option>
                                <option value="take" selected>Take</option>
                                <option value="custom">Custom</option>
                            </select>
                            <input type="text" id="mp-rename-custom3" placeholder="custom text" style="min-width: 90px; display: none;">
                        </div>
                    </div>
                </div>

                <!-- Output Bit Depth -->
                <div class="mp-section mp-output-section">
                    <div class="mp-input-group">
                        <label>Output Bit Depth:</label>
                        <select id="mp-output-bitdepth">
                            <option value="same" selected>Same as source</option>
                            <option value="16">16-bit</option>
                            <option value="24">24-bit</option>
                            <option value="32f">32-bit Float</option>
                        </select>
                    </div>
                </div>

                <!-- Save To -->
                <div class="mp-section mp-save-section">
                    <div class="mp-input-group">
                        <label>Save To:</label>
                        <button id="mp-destination-btn" class="btn secondary small-btn">Destination</button>
                        <span id="mp-destination-path" class="mp-destination-path">Same as source</span>
                    </div>
                </div>

            </div>
            <div class="modal-footer">
                <button id="multi-process-exit-btn" class="btn secondary">Close</button>
                <button id="multi-process-process-btn" class="btn primary">Process</button>
            </div>
        </div>
    </div>

    <!-- Multi-Process Channel Order Modal -->
    <div id="mp-channel-order-modal" class="modal">
        <div class="modal-content large-modal">
            <div class="modal-header">
                <h3>Channel Order for Combine to Poly</h3>
                <button class="modal-close" id="mp-channel-order-close-btn">&times;</button>
            </div>
            <div class="modal-body">
                <p style="color: var(--text-secondary); font-size: 0.9rem; margin-bottom: 1rem;">Drag files to reorder channels. This will apply to all groups created during the multi-process operation.</p>
                <div id="mp-channel-preview-container" style="background: var(--bg-secondary); padding: 1rem; border-radius: 6px; max-height: 400px; overflow-y: auto;">
                    <!-- Channel list will be populated here -->
                </div>
            </div>
            <div class="modal-footer">
                <button id="mp-channel-order-close-btn-footer" class="btn secondary">Close</button>
            </div>
        </div>
    </div>

    <div id="cue-marker-modal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h3>Edit Cue Marker</h3>
                <button class="modal-close" id="cue-close-btn">&times;</button>
            </div>
            <div class="modal-body">
                <div class="form-group">
                    <label for="cue-label-input">Label (max 64 characters):</label>
                    <input type="text" id="cue-label-input" maxlength="64" placeholder="Enter marker label">
                </div>
                <div class="form-group">
                    <label for="cue-time-display">Time:</label>
                    <input type="text" id="cue-time-display" readonly>
                </div>
            </div>
            <div class="modal-footer">
                <button id="cue-cancel-btn" class="btn secondary">Cancel</button>
                <button id="cue-delete-btn" class="btn secondary" style="background: #c62828;">Delete</button>
                <button id="cue-apply-btn" class="btn primary">Apply</button>
            </div>
        </div>
    </div>

    <!-- Info Sidebar -->
    <div id="info-sidebar" class="info-sidebar">
        <div class="sidebar-header">
            <h3>Selected Takes</h3>
        </div>
        <div class="sidebar-content" id="sidebar-content">
            <p class="sidebar-empty">No takes selected</p>
        </div>
    </div>

    <script src="lame.min.js"></script>
    <script src="cue-marker.js"></script>
    <script type="module" src="app.js"></script>
    <script>
        // Register Service Worker for offline support
        if ('serviceWorker' in navigator) {
            window.addEventListener('load', () => {
                navigator.serviceWorker.register('./sw.js')
                    .then((registration) => {
                        console.log('‚úÖ Service Worker registered successfully:', registration.scope);

                        // Check for updates
                        registration.addEventListener('updatefound', () => {
                            const newWorker = registration.installing;
                            console.log('üîÑ Service Worker update found');

                            newWorker.addEventListener('statechange', () => {
                                if (newWorker.state === 'activated') {
                                    console.log('‚úÖ Service Worker updated and activated');
                                    // Optionally notify user to reload
                                    if (confirm('New version available! Reload to update?')) {
                                        window.location.reload();
                                    }
                                }
                            });
                        });
                    })
                    .catch((error) => {
                        console.error('‚ùå Service Worker registration failed:', error);
                    });
            });
        } else {
            console.warn('‚ö†Ô∏è Service Workers not supported in this browser');
        }
    </script>

    <!-- Combine Sibling Files Modal -->
    <div id="combine-modal" class="modal">
        <div class="modal-content large-modal">
            <div class="modal-header">
                <h3>Combine Sibling Files into Polyphonic File</h3>
                <button class="modal-close" id="combine-close-btn">&times;</button>
            </div>
            <div class="modal-body">
                <!-- Shared Output Settings -->
                <div class="combine-output-settings" style="background: var(--bg-secondary); padding: 1em; margin-bottom: 1.5em; border-radius: 4px;">
                    <h4 style="margin-top: 0; margin-bottom: 1em; font-size: 1.1em;">Output Settings (applies to all groups)</h4>
                    
                    <!-- Filename Format -->
                    <div style="margin-bottom: 1em;">
                        <label style="display: block; margin-bottom: 0.5em; font-weight: 600;">Filename Format:</label>
                        <div style="display: flex; gap: 0.5em; flex-wrap: wrap; align-items: center;">
                            <div style="display: flex; gap: 0.3em; align-items: center;">
                                <label style="margin: 0; font-size: 0.9em;">Field 1:</label>
                                <select id="combine-rename-field1" class="mp-field-select" style="min-width: 90px;">
                                    <option value="none">None</option>
                                    <option value="project">Project</option>
                                    <option value="tape">Tape</option>
                                    <option value="scene" selected>Scene</option>
                                    <option value="take">Take</option>
                                    <option value="custom">Custom</option>
                                </select>
                                <input type="text" id="combine-rename-custom1" placeholder="custom text" style="min-width: 90px; display: none;">
                            </div>
                            <div style="display: flex; gap: 0.3em; align-items: center;">
                                <label style="margin: 0; font-size: 0.9em;">Sep:</label>
                                <select id="combine-rename-separator1" style="min-width: 60px;">
                                    <option value="">None</option>
                                    <option value="T" selected>T</option>
                                    <option value="-">-</option>
                                    <option value="_">_</option>
                                    <option value="=">=</option>
                                    <option value="~">~</option>
                                    <option value="+">+</option>
                                    <option value=",">,</option>
                                    <option value=".">.</option>
                                </select>
                            </div>
                            <div style="display: flex; gap: 0.3em; align-items: center;">
                                <label style="margin: 0; font-size: 0.9em;">Field 2:</label>
                                <select id="combine-rename-field2" class="mp-field-select" style="min-width: 90px;">
                                    <option value="none">None</option>
                                    <option value="project">Project</option>
                                    <option value="tape">Tape</option>
                                    <option value="scene">Scene</option>
                                    <option value="take" selected>Take</option>
                                    <option value="custom">Custom</option>
                                </select>
                                <input type="text" id="combine-rename-custom2" placeholder="custom text" style="min-width: 90px; display: none;">
                            </div>
                            <div style="display: flex; gap: 0.3em; align-items: center;">
                                <label style="margin: 0; font-size: 0.9em;">Sep:</label>
                                <select id="combine-rename-separator2" style="min-width: 60px;">
                                    <option value="">None</option>
                                    <option value="T">T</option>
                                    <option value="-">-</option>
                                    <option value="_">_</option>
                                    <option value="=">=</option>
                                    <option value="~">~</option>
                                    <option value="+">+</option>
                                    <option value=",">,</option>
                                    <option value=".">.</option>
                                </select>
                            </div>
                            <div style="display: flex; gap: 0.3em; align-items: center;">
                                <label style="margin: 0; font-size: 0.9em;">Field 3:</label>
                                <select id="combine-rename-field3" class="mp-field-select" style="min-width: 90px;">
                                    <option value="none" selected>None</option>
                                    <option value="project">Project</option>
                                    <option value="tape">Tape</option>
                                    <option value="scene">Scene</option>
                                    <option value="take">Take</option>
                                    <option value="custom">Custom</option>
                                </select>
                                <input type="text" id="combine-rename-custom3" placeholder="custom text" style="min-width: 90px; display: none;">
                            </div>
                        </div>
                    </div>
                    
                    <!-- Destination Folder -->
                    <div style="display: flex; align-items: center; gap: 1em;">
                        <label style="margin: 0; font-weight: 600;">Destination:</label>
                        <button id="combine-select-dir-btn" class="btn secondary">Select Destination Folder</button>
                        <span id="combine-dest-path" style="color: var(--text-muted); font-size: 0.95em;">Same as source files</span>
                    </div>
                </div>
                
                <!-- File Groups -->
                <div id="combine-groups-container">
                    <!-- Sibling groups will be listed here -->
                </div>
            </div>
            <div class="modal-footer">
                <button id="combine-cancel-btn" class="btn secondary">Cancel</button>
                <button id="combine-confirm-btn" class="btn primary">Combine Files</button>
            </div>
        </div>
    </div>

    <!-- Split Modal -->
    <div id="split-modal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h3>Split Polyphonic File</h3>
                <button class="modal-close" id="split-close-btn">&times;</button>
            </div>
            <div class="modal-body">
                <p class="modal-info">Split <span id="split-filename"></span> into individual monophonic files.</p>
                <p class="modal-info">Each output file will retain all original metadata with the correct track name.</p>
                <div class="form-row" style="display: flex; align-items: center; gap: 1.5em; margin-top: 1.5em;">
                    <label style="margin: 0; min-width: 100px;">Bit Depth:</label>
                    <select id="split-bitdepth" style="padding: 0.5em; border-radius: 4px; border: 1px solid var(--input-border); min-width: 180px;">
                        <option value="preserve">Preserve original</option>
                        <option value="16">16-bit</option>
                        <option value="24">24-bit</option>
                    </select>
                </div>
                <div class="form-row" style="display: flex; align-items: center; gap: 1.5em; margin-top: 1.5em;">
                    <label style="margin: 0; min-width: 70px;">Save to:</label>
                    <button id="split-folder-btn" class="btn secondary" style="min-width: 220px;">Select Destination Folder</button>
                    <span id="split-folder-path" style="color: var(--text-muted); font-size: 0.95em; margin-left: 0.5em;">Same as source files</span>
                </div>
            </div>
            <div class="modal-footer">
                <button id="split-cancel-btn" class="btn secondary">Cancel</button>
                <button id="split-confirm-btn" class="btn primary" disabled>Split Files</button>
            </div>
        </div>
    </div>

    <!-- Toast Notification -->
    <div id="toast-notification" class="toast-notification"></div>

<!-- Sound Report Modal (root level, not nested) -->
<div id="sound-report-modal" class="modal" style="display:none;">
    <div class="modal-content sound-report-modal-content">
        <div class="modal-header">
            <h2>Sound Report</h2>
            <button class="modal-close" id="close-sound-report">&times;</button>
        </div>
        <div class="modal-body">
            <form id="sound-report-form">
                <!-- Title Section -->
                <div class="report-title-section">
                    <label>Company Name (optional): <input type="text" id="report-company" maxlength="64"></label>
                    <label>Logo (jpg/png): <input type="file" id="report-logo" accept="image/png, image/jpeg"></label>
                </div>
                <!-- Header Fields -->
                <div class="report-header-fields" id="report-header-fields">
                    <!-- Rendered by JS: 22 header items, 4 columns (6,6,6,4) -->
                </div>
                <!-- Take List Table -->
                <div class="report-take-list-section">
                    <h3>Take List</h3>
                    <div class="take-list-options">
                        <label><input type="checkbox" id="report-notes-separate-line"> Notes on Separate Line</label>
                    </div>
                    <div id="report-take-list-table-container">
                        <!-- Table will be rendered here by JS -->
                    </div>
                </div>
            </form>
        </div>
        <div class="modal-footer">
            <div class="report-export-format-group">
                <label><input type="radio" name="report-export-format" value="csv" checked> CSV</label>
                <label><input type="radio" name="report-export-format" value="pdf"> PDF</label>
                <span style="margin-left:0.5em;">Export format</span>
            </div>
            <button id="create-report-btn" class="btn primary">Create Report</button>
            <button id="exit-report-btn" class="btn secondary">Close</button>
        </div>
    </div>
</div>
<script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
<script src="renameUtilities.js"></script>
<script src="sound-report.js"></script>
<script src="sound-report-export.js"></script>

</body>

</html>